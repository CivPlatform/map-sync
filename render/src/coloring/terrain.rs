use crate::color::TRANSPARENT;
use crate::render::{get_column_in_map, ChunkMap};
use std::fs::File;
use std::io::BufReader;

pub fn get_terrain_color(map: &ChunkMap, x: i32, z: i32) -> u32 {
    let col = get_column_in_map(map, x, z);
    if col.is_none() {
        return TRANSPARENT;
    }
    let col = col.unwrap();
    COLORS[col.ground_layer().id as usize]
}

lazy_static! {
    static ref COLORS: Vec<u32> = {
        #[derive(serde::Deserialize)]
        struct BlockJson {
            id: usize,
            minStateId: usize,
            maxStateId: usize,
        }
        let file = File::open("blocks.json").expect("reading blocks.json");
        let reader = BufReader::new(file);
        let json: Vec<BlockJson> = serde_json::from_reader(reader).expect("parsing blocks.json");
        let last_block = json.last().expect("getting last blocks.json entry");
        let mut colors = vec![0_u32; last_block.maxStateId + 1];
        for o in json {
            for bsid in o.minStateId..=o.maxStateId {
                colors[bsid] = BLOCK_COLORS[o.id];
            }
        }
        colors
    };
}

const BLOCK_COLORS: [u32; 898] = [
    0xffff00ff, 0xff7d7d7d, 0xff956755, 0xff9a6a59, 0xffbcbcbc, 0xffc0c1c2, 0xff888888, 0xff848685,
    0xff939393, 0xff866043, 0xff77553b, 0xff939393, 0xff7f7f7f, 0xffa2824e, 0xff725430, 0xffc0af79,
    0xffa07350, 0xffa85a32, 0xff422b14, 0xff4d6a28, 0xff2c3c24, 0xff7fa04f, 0xff2f5110, 0xff767517,
    0xff3d5a1e, 0xff555555, 0xffb1b1b1, 0xffd8681a, 0xffdbcfa3, 0xffbe6621, 0xff837f7e, 0xff91856a,
    0xff73664e, 0xff88817a, 0xff6a635e, 0xff696969, 0xff4a4a4c, 0xff73362a, 0xff6d5532, 0xff3a2510,
    0xffd8d7d2, 0xff554319, 0xff676056, 0xff3c2e1a, 0xff735934, 0xffc4b076, 0xffab8454, 0xffae5c3b,
    0xff483824, 0xffb19056, 0xff6d5532, 0xff3a2510, 0xffd8d7d2, 0xff554319, 0xff676056, 0xff3c2e1a,
    0xffb19056, 0xff735934, 0xffc4b076, 0xffab8454, 0xffae5c3b, 0xff483824, 0xff909090, 0xff7e7e7e,
    0xff828182, 0xff9c9a8f, 0xff959494, 0xff969696, 0xff5a722c, 0xff636f3c, 0xffc3c04a, 0xffabb546,
    0xffafd5db, 0xff6b758d, 0xff4f5a73, 0xff1e438c, 0xff6e6d6d, 0xffdfd6aa, 0xffdfd6aa, 0xffdfd6aa,
    0xff583a28, 0xffa2824e, 0xffa2824e, 0xffa2824e, 0xffa2824e, 0xffa2824e, 0xffa2824e, 0xffa2824e,
    0xffa2824e, 0xffa2824e, 0xffa2824e, 0xffa2824e, 0xffa2824e, 0xffa2824e, 0xffa2824e, 0xffa2824e,
    0xffa2824e, 0xff9a6d4a, 0xff896759, 0xff6e6860, 0xffe4e9ea, 0xff919191, 0xff7c7c7c, 0xff6b4e28,
    0xff337e08, 0xff3a8a0d, 0xff6e6860, 0xff6e6860, 0xffe9ecec, 0xfff07613, 0xffbd44b3, 0xff3aafd9,
    0xfff8c527, 0xff70b919, 0xffed8dac, 0xff3e4447, 0xff8e8e86, 0xff158991, 0xff792aac, 0xff35399d,
    0xff724728, 0xff546d1b, 0xffa02722, 0xff141519, 0, 0xffafb401, 0xff980406, 0xff1e7eb6,
    0xff8549b6, 0xff9da1a7, 0xff980406, 0xffa3581a, 0xffb0b0b0, 0xffb09ab0, 0xffb3b3b3, 0xff334cb2,
    0xff191919, 0xffffffff, 0xff99745c, 0xffd84b43, 0xfff6d03d, 0xffdcdcdc, 0xff966153, 0xff8e3e35,
    0xffa2824e, 0xff6e765e, 0xff0f0a18, 0xff8a713f, 0xff8a713f, 0xffd69235, 0xff37c8cc, 0xff242e3e,
    0xffa2824e, 0xffa2824e, 0xfff0f0f0, 0xff798d8c, 0xff536a6a, 0xff62ede4, 0xff77492a, 0xff087f0f,
    0xff8f6646, 0xff6e6d6d, 0, 0, 0, 0, 0, 0, 0xff8c6e42, 0xff7c6036, 0xff7d6f58, 0xff7f7f7f, 0, 0,
    0, 0, 0, 0, 0xff7e7c7b, 0xff7d7d7d, 0xffc2c1c1, 0xffa2824e, 0xff725430, 0xffc0af79, 0xffa07350,
    0xffa85a32, 0xff422b14, 0xff8c6d6d, 0xff68494a, 0xffab4f2c, 0xffab4f2c, 0xff7d7d7d, 0xfff9fefe,
    0xff91b7fd, 0xfff9fefe, 0xff557f2b, 0xffa0a6b3, 0xff94c065, 0xff5d402f, 0xffa2824e, 0xffc67618,
    0xff612626, 0xff513e32, 0xff4b392e, 0xff49484d, 0xff58585b, 0xff6d7359, 0xff6d7359, 0xffab8354,
    0xff590cc0, 0xffc67618, 0xffc67618, 0xffe7c4b4, 0xff817774, 0xffffffff, 0xffd87f33, 0xffb24cd8,
    0xff6699d8, 0xffe5e533, 0xff7fcc19, 0xfff27fa5, 0xff4c4c4c, 0xff999999, 0xff4c7f99, 0xff7f3fb2,
    0xff334cb2, 0xff664c33, 0xff667f33, 0xff993333, 0xff191919, 0xff7c6338, 0xff674f2f, 0xffcfc29d,
    0xff986e4d, 0xff9c5733, 0xff4b3117, 0xff7a797a, 0xff737969, 0xff767576, 0xff777677, 0xff7d7d7d,
    0xff7f7f7f, 0xff7a797a, 0xff737969, 0xff767576, 0xff777677, 0xff956f51, 0xffc82e2d, 0xffcbc4b9,
    0xff888b87, 0xff33394a, 0xffadd4da, 0xff6f901e, 0xff929292, 0xff939493, 0xff9a9a9a, 0xff999999,
    0xff747474, 0xff708279, 0xffa2824e, 0xff966153, 0xff7a797a, 0xff939393, 0xff858585, 0xff2c151a,
    0xff2c151a, 0xff2c151a, 0xff751215, 0xff804b55, 0xff766861, 0xff49484a, 0xff3a393d, 0xff3a393d,
    0xff3a393d, 0, 0xff23463e, 0xffdbde9e, 0xff0c090f, 0xff8e653c, 0xff85863e, 0xffd7ca9a,
    0xff6c8873, 0xff4e6857, 0xff0f0a18, 0xff9b825a, 0xff818181, 0xff2acb57, 0xff725430, 0xffc0af79,
    0xffa07350, 0xffb28569, 0xff4e7e83, 0xff7f7f7f, 0xff6e765e, 0xff845b40, 0xff755f3a, 0xff71553a,
    0xff836c44, 0xff715936, 0xff806235, 0xff715b37, 0xff82634e, 0xff86633e, 0xff84593e, 0xff79644d,
    0xff87604d, 0xff896948, 0xff7e603c, 0xff7f613c, 0xff7f6541, 0xff806342, 0xff8b6b4c, 0xff7f5e49,
    0xff836745, 0xff7a563c, 0xff8c5a41, 0xff865e43, 0xff7f593b, 0xff557f2b, 0xff2c6e27, 0xff3a8128,
    0xffa2824e, 0xff725430, 0xffc0af79, 0xffa07350, 0xffa85a32, 0xff422b14, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0xff464646, 0xff464646, 0xff454545, 0xffa2824e, 0xfff6d03d, 0xffdcdcdc, 0xffaa938c,
    0xff6a6d70, 0xffaf1805, 0xff75413e, 0xff3e3d40, 0xffebe5de, 0xffe7e2d9, 0xffebe6e0, 0xffebe5de,
    0xff8f574a, 0xff6e6d6d, 0xffd1b2a1, 0xffa15325, 0xff95586c, 0xff716c89, 0xffba8523, 0xff677534,
    0xffa14e4e, 0xff392a23, 0xff876a61, 0xff565b5b, 0xff764656, 0xff4a3b5b, 0xff4d3323, 0xff4c532a,
    0xff8f3d2e, 0xff251610, 0xfffefefe, 0xffd77e32, 0xffb14bd7, 0xff6598d7, 0xffe4e432, 0xff7ecb18,
    0xfff17ea4, 0xff4b4b4b, 0xff989898, 0xff4b7e98, 0xff7e3eb1, 0xff324bb1, 0xff654b32, 0xff657e32,
    0xff983232, 0xff181818, 0xffa85a32, 0xff422b14, 0xff6fc05b, 0, 0, 0xffcacaca, 0xff62a291,
    0xff63ab9e, 0xff335b4b, 0xff62a291, 0xff63ab9e, 0xff335b4b, 0xff62a291, 0xff63ab9e, 0xff335b4b,
    0xffacc8be, 0xffa68826, 0xffe9ecec, 0xfff07613, 0xffbd44b3, 0xff3aafd9, 0xfff8c527, 0xff70b919,
    0xffed8dac, 0xff3e4447, 0xff8e8e86, 0xff158991, 0xff792aac, 0xff35399d, 0xff724728, 0xff546d1b,
    0xffa02722, 0xff141519, 0xff985e43, 0xff100f0f, 0xff8db4fa, 0xff7f9a28, 0xff9a7d93, 0xff834225,
    0xff817e8b, 0xff979597, 0xff7d7d7d, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xffb5611f, 0xffb5611f, 0xffb5611f, 0xffb9621c, 0xffa2824e,
    0xff725430, 0xffc0af79, 0xffa07350, 0xffa85a32, 0xff422b14, 0xff7d7d7d, 0xff9e9e9e, 0xffdfd6aa,
    0xffdfd6aa, 0xffa2824e, 0xff7f7f7f, 0xff966153, 0xff7a797a, 0xff2c151a, 0xffebe5de, 0xffb5611f,
    0xffb5611f, 0xffa97da9, 0xff9e9e9e, 0xffdfd6aa, 0xffece6df, 0xffb5611f, 0xff725430, 0xffc0af79,
    0xffa07350, 0xffa85a32, 0xff422b14, 0xff725430, 0xffc0af79, 0xffa07350, 0xffa85a32, 0xff422b14,
    0xff6a5030, 0xffdcd1b0, 0xffa37754, 0xffa75f3c, 0xff4c3319, 0xffcdc4b9, 0xff5d395d, 0xff7a597a,
    0xffa97da9, 0xffab81ab, 0xffa97da9, 0xffdae0a2, 0xff418929, 0xff947941, 0, 0xff7f6dab,
    0xff81a193, 0xff8cb5fc, 0xff8d3e1e, 0xff720202, 0xff450709, 0xffe5e1cf, 0, 0xff626262,
    0xff8b608b, 0xffd7dcdd, 0xffea6a08, 0xffad36a3, 0xff31a3d4, 0xfff8bc1d, 0xff63ac17, 0xffe6799d,
    0xff373a3e, 0xff7c7c73, 0xff147987, 0xff67209c, 0xff2b2d8c, 0xff6a4223, 0xff4f641f, 0xff8c1f1e,
    0xff19191d, 0xffbcd4ca, 0xff9a935b, 0xffd064bf, 0xff5ea4d0, 0xffeac058, 0xffa2c537, 0xffeb9ab5,
    0xff535a5d, 0xff90a6a7, 0xff34767d, 0xff6d3098, 0xff2f408b, 0xff776a55, 0xff758e43, 0xffb53b35,
    0xff431e20, 0xffcfd5d6, 0xffe06100, 0xffa9309f, 0xff2389c6, 0xfff0af15, 0xff5ea818, 0xffd5658e,
    0xff36393d, 0xff7d7d73, 0xff157788, 0xff641f9c, 0xff2c2e8f, 0xff603b1f, 0xff495b24, 0xff8e2020,
    0xff080a0f, 0xffe1e3e3, 0xffe3831f, 0xffc053b8, 0xff4ab4d5, 0xffe8c736, 0xff7dbd29, 0xffe499b5,
    0xff4c5154, 0xff9a9a94, 0xff24939d, 0xff8337b1, 0xff4649a6, 0xff7d5435, 0xff61772c, 0xffa83632,
    0xff191a1f, 0xff578d2d, 0xff56822a, 0xff323a26, 0xffe4e2bf, 0xff827b77, 0xff7c7572, 0xff837b77,
    0xff837b77, 0xff857e7a, 0xff3157ce, 0xffcf5b9f, 0xffa51aa2, 0xffa3232e, 0xffd8c742, 0xff766f6b,
    0xff857d78, 0xff847c78, 0xff88807c, 0xff8e8781, 0xff2f53c5, 0xffc55498, 0xffa1179f, 0xffa6252e,
    0xffd1ba3e, 0xff807a76, 0xff847d79, 0xff8c8682, 0xff7c7672, 0xff867d79, 0xff325bd0, 0xffca5499,
    0xffa0209f, 0xff9e222d, 0xffcdb73d, 0xff807a76, 0xff847d79, 0xff8c8682, 0xff7c7672, 0xff867d79,
    0xff325bd0, 0xffca5499, 0xffa0209f, 0xff9e222d, 0xffcdb73d, 0xff5a6127, 0xff74a7fd, 0xff9f8b71,
    0xff5c5923, 0xff5d9013, 0xff5d9013, 0, 0, 0, 0xff9a6a59, 0xffb5611f, 0xff737969, 0xffc0c1c2,
    0xff6e765e, 0xffdae0a2, 0xff7d7d7d, 0xffdfd6aa, 0xffece6df, 0xff956755, 0xff888888, 0xff450709,
    0xff848685, 0xffbcbcbc, 0xff9a6a59, 0xffb5611f, 0xff737969, 0xffc0c1c2, 0xff6e765e, 0xffdae0a2,
    0xffdfd6aa, 0xffece6df, 0xff956755, 0xff888888, 0xff450709, 0xff848685, 0xffbcbcbc, 0xff966153,
    0xff62a291, 0xffba631d, 0xff737969, 0xff956755, 0xff7a797a, 0xff2c151a, 0xff888888, 0xff450709,
    0xffd8cb9b, 0xffdae0a2, 0xffbcbcbc, 0xffae8650, 0xff8e775b, 0xff6b5132, 0xff555351, 0xff505051,
    0xff675743, 0xffc5b485, 0xff8e8e8e, 0xff9b7947, 0xff393a46, 0xff938f8a, 0xff7d7d7d, 0xff6a5c54,
    0xff466272, 0xff7c643c, 0xff4c7673, 0xff2a5938, 0xff393b4d, 0xff399693, 0xff393b4d, 0xff399693,
    0xff2b7265, 0xff4a6d57, 0xff167779, 0xff148a7c, 0xff139785, 0xff5d1a1e, 0xff89395a, 0xff5d1a1e,
    0xff89395a, 0xff821f1f, 0xff8d2c1d, 0xfff09246, 0xff680100, 0xff84100c, 0xff148f7c, 0xff14877a,
    0xff7e0829, 0xff653046, 0xff2b6863, 0xff653046, 0xff2b6863, 0xff653046, 0xff2b6863, 0xff653046,
    0xff2b6863, 0xff673248, 0xff2f776f, 0xff653046, 0xff2b6863, 0xff653046, 0xff2b6863, 0xff653046,
    0xff2b6863, 0xff72364f, 0xff2c7e78, 0, 0, 0, 0, 0xff564757, 0xff221b25, 0xff986233, 0xffe2aa9d,
    0xffcaa04a, 0xffb4925a, 0xfff19211, 0xffe5941d, 0xff423d3f, 0xff5e423a, 0xff200a3c, 0xff211534,
    0xff86533b, 0xff7c5e44, 0xff834d3c, 0xff6f644b, 0xff939598, 0xff2a2429, 0xff2a2429, 0xff2a2328,
    0xff2a2429, 0xff353038, 0xff302a31, 0xff2c252b, 0xff353038, 0xff302a31, 0xff302a31, 0xff302a31,
    0xff372a26, 0xff353038, 0xff353038, 0xff353038, 0xff353038, 0xff353038, 0xff2f171c, 0xff281417,
    0xffeae5dd, 0xffebd2ad, 0xffd9d9ce, 0xffe2831a, 0xffb645a1, 0xff45a1c9, 0xffd8b74a, 0xff7cb51e,
    0xffd98396, 0xff767a6c, 0xff97937e, 0xff2b9286, 0xff7c2190, 0xff4054b3, 0xff936033, 0xff647316,
    0xffb4412f, 0xff493033, 0xffe7c5b4, 0xffe6c6b6, 0xffe7c0aa, 0xffe4bcb3, 0xffddc2b5, 0xffe6c4ad,
    0xffe0c3ab, 0xffe6c0b2, 0xffe0c0b0, 0xffe2c1b1, 0xffdbc1b1, 0xffe0bab2, 0xffddbdb4, 0xffe2beac,
    0xffdfbfaa, 0xffe4bcac, 0xffddbbac, 0xff8561bf, 0xff8460ba, 0xffa37ecf, 0xffa17eca, 0xff9e78c9,
    0xff8363c0, 0xff6c6d66, 0xffdfe0dc, 0xff2b262d, 0xfff8fdfd, 0xff074553, 0xff52a284, 0xff6c996e,
    0xffa17d67, 0xffc06b4f, 0xff7c7d78, 0xff5c5d59, 0xff4f997e, 0xff6d916b, 0xff9a7965, 0xffbf6a50,
    0xff4f997e, 0xff6d916b, 0xff9a7965, 0xffbf6a50, 0xff4f997e, 0xff6d916b, 0xff9a7965, 0xffbf6a50,
    0xffc06b4f, 0xff6c996e, 0xffa17d67, 0xff52a284, 0xff4f997e, 0xff6d916b, 0xff9a7965, 0xffbf6a50,
    0xff4f997e, 0xff6d916b, 0xff9a7965, 0xffbf6a50, 0xff4f997e, 0xff6d916b, 0xff9a7965, 0xffbf6a50,
    0xffffffff, 0xff8a6f5f, 0xff866b5c, 0xff697029, 0xff696b28, 0xff9a7a61, 0xff657c2f, 0xff707940,
    0xff596d2d, 0xff596d2d, 0xff688531, 0xff5b732d, 0xff60782e, 0xffa1735b, 0xff90674c, 0xff505052,
    0xff4d4d50, 0xff4d4d50, 0xff4d4d50, 0xff4d4d50, 0xff484849, 0xff484849, 0xff484849, 0xff484849,
    0xff363637, 0xff363637, 0xff363637, 0xff363637, 0xff464647, 0xff464647, 0xff464647, 0xff464647,
    0xff363636, 0xff404041, 0xff343434, 0xff505052, 0xff48484e, 0xffa6876b, 0xff9a694f, 0xffdda92e,
    0xff647a2f, 0xff727746,
];
